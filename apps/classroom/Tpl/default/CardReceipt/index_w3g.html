<include file="__THEME__/public_header_w3g" />
<style media="screen">
    <if condition="$card_type eq 1">
    .content_list li{background: url(__APP__/images/bg_coupon.png) 0 0 no-repeat;background-size: 100% 160px;-webkit-background-size:100% 160px;-moz-background-size:100% 160px;-o-background-size:100% 160px;-ms-background-size:100% 160px}
    .content_list li .left_box .num,.content_list li .left_box .fracture{color: #f77a7a;}
    .content_list li .left_box .coupon{background: #f77a7a;}
    <elseif condition="$card_type eq 2"/>
    .content_list li{background: url(__APP__/images/bg_diacount.png) 0 0 no-repeat;background-size: 100% 160px;-webkit-background-size:100% 160px;-moz-background-size:100% 160px;-o-background-size:100% 160px;-ms-background-size:100% 160px}
    .content_list li .left_box .num,.content_list li .left_box .fracture{color: #5aa4e0;}
    .content_list li .left_box .coupon{background: #5aa4e0;}
    <elseif condition="$card_type eq 3"/>
    .content_list li{background: url(__APP__/images/bg_vip.png) 0 0 no-repeat;background-size: 100% 160px;-webkit-background-size:100% 160px;-moz-background-size:100% 160px;-o-background-size:100% 160px;-ms-background-size:100% 160px}
    .content_list li .left_box .num,.content_list li .left_box .fracture{color: #ff8a65;}
    .content_list li .left_box .coupon{background: #ff8a65;}
    <elseif condition="$card_type eq 4"/>
    .content_list li{background: url(__APP__/images/bg_recharge.png) 0 0 no-repeat;background-size: 100% 160px;-webkit-background-size:100% 160px;-moz-background-size:100% 160px;-o-background-size:100% 160px;-ms-background-size:100% 160px}
    .content_list li .left_box .num,.content_list li .left_box .fracture{color: #4ac1a4;}
    .content_list li .left_box .coupon{background: #4ac1a4;}
    .content_list li .left_box .first_p{margin-top: 20px;}
    <elseif condition="$card_type eq 5"/>
    .content_list li{background: url(__APP__/images/bg_course.png) 0 0 no-repeat;background-size: 100% 160px;-webkit-background-size:100% 160px;-moz-background-size:100% 160px;-o-background-size:100% 160px;-ms-background-size:100% 160px}
    .content_list li .left_box .num,.content_list li .left_box .fracture{color: #8c9eff;}
    .content_list li .left_box .coupon{background: #8c9eff;}
    .content_list li .left_box .first_p{margin-top: 20px;}
    </if>
</style>
<link rel="stylesheet" href="__APP__/css/receipt_style_w3g.css">

<!-- content start -->
<section>
    <div class="main">
        <div class="vip_center">
            <p class="receipt_font">领券中心</p>
            <p class="receipt_mine"><a href="{:U('classroom/User/videoCoupon')}">我的卡券</a></p>
        </div>
        <div class="receipt_list">
            <ul>
                <li <if condition="$card_type eq 1">class="on"</if> ><a href="{:U('classroom/CardReceipt/index',['tab'=>'coupon'])}">优惠券</a></li>
                <li <if condition="$card_type eq 2">class="on"</if> ><a href="{:U('classroom/CardReceipt/index',['tab'=>'discount_card'])}">打折卡</a></li>
                <li <if condition="$card_type eq 3">class="on"</if> ><a href="{:U('classroom/CardReceipt/index',['tab'=>'vip_card'])}">会员卡</a></li>
                <li <if condition="$card_type eq 4">class="on"</if> ><a href="{:U('classroom/CardReceipt/index',['tab'=>'recharge_card'])}">充值卡</a></li>
                <li <if condition="$card_type eq 5">class="on"</if> ><a href="{:U('classroom/CardReceipt/index',['tab'=>'course_card'])}">课程卡</a></li>
            </ul>
        </div>
        <div class="content_list">
            <if condition="$card_list['data']">
                <ul id="content_ul_list">
                    <volist name="card_list.data" id="clt" >
                        <if condition="$card_type eq 1">
                            <li <if condition="$clt['is_receive']">style="background:url(__APP__/images/bg_none.png) 0 0 no-repeat;background-size:100% 160px;-webkit-background-size:100% 160px;-moz-background-size:100% 160px;-o-background-size:100% 160px;-ms-background-size:100% 160px;"</if>>
                                <div class="left_box">
                                    <p class="first_p"><span class="fracture">￥ </span><span class="num">{$clt['price']}</span><span class="coupon">优惠券</span></p>
                                    <p class="second_p">满<span>{$clt['maxprice']}</span>元可用 <span>{$clt['exp_date']}</span>天内有效</p>
                                    <p class="three_p">限<span>{$clt['school_title']}</span>机构内所有课程可用</p>
                                    <p class="four_p">{$clt['ctime']} - {$clt['end_time']}</p>
                                </div>
                                <if condition="$clt['is_receive']">
                                    <a href="javascript:" <if condition="$clt['is_receive']">style="padding-top: 45px"</if> >已<br>领<br>取</a>
                                    <else/>
                                    <a href="javascript:" class="btn_use" data-coupon-code="{$clt['coupon_id']}">立<br>即<br>领<br>取</a>
                                </if>
                            </li>
                            <elseif condition="$card_type eq 2"/>
                            <li <if condition="$clt['is_receive']">style="background:url(__APP__/images/bg_none.png) 0 0 no-repeat;background-size:100% 160px;-webkit-background-size:100% 160px;-moz-background-size:100% 160px;-o-background-size:100% 160px;-ms-background-size:100% 160px;"</if>>
                                <div class="left_box">
                                    <p class="first_p"><span class="num">{$clt['discount']}</span><span class="fracture">折</span><span class="coupon">打折券</span></p>
                                    <p class="second_p"><span>{$clt['exp_date']}</span>天内有效</p>
                                    <p class="three_p">限<span>{$clt['school_title']}</span>机构内所有课程可用</p>
                                    <p class="four_p">{$clt['ctime']} - {$clt['end_time']}</p>
                                </div>
                                <if condition="$clt['is_receive']">
                                    <a href="javascript:" <if condition="$clt['is_receive']">style="padding-top: 45px"</if> >已<br>领<br>取</a>
                                    <else/>
                                    <a href="javascript:" class="btn_use" data-coupon-code="{$clt['coupon_id']}">立<br>即<br>领<br>取</a>
                                </if>
                            </li>
                            <elseif condition="$card_type eq 3"/>
                            <li <if condition="$clt['is_receive']">style="background:url(__APP__/images/bg_none.png) 0 0 no-repeat;background-size:100% 160px;-webkit-background-size:100% 160px;-moz-background-size:100% 160px;-o-background-size:100% 160px;-ms-background-size:100% 160px;"</if>>
                                <div class="left_box">
                                    <p class="first_p"><span class="num">{$clt['vip_date']}</span><span class="fracture">天</span><span class="coupon">会员券</span></p>
                                    <p class="second_p">{$clt['vip_grade_list']['title']} <span>{$clt['exp_date']}</span>天内有效</p>
                                    <p class="four_p">{$clt['ctime']} - {$clt['end_time']}</p>
                                </div>
                                <if condition="$clt['is_receive']">
                                    <a href="javascript:" <if condition="$clt['is_receive']">style="padding-top: 45px"</if> >已<br>领<br>取</a>
                                    <else/>
                                    <a href="javascript:" class="btn_use" data-coupon-code="{$clt['coupon_id']}">立<br>即<br>领<br>取</a>
                                </if>
                            </li>
                            <elseif condition="$card_type eq 4"/>
                            <li <if condition="$clt['is_receive']">style="background:url(__APP__/images/bg_none.png) 0 0 no-repeat;background-size:100% 160px;-webkit-background-size:100% 160px;-moz-background-size:100% 160px;-o-background-size:100% 160px;-ms-background-size:100% 160px;"</if>>
                                <div class="left_box">
                                    <p class="first_p"><span class="num">{$clt['recharge_price']}</span><span class="fracture">元</span><span class="coupon">余额券</span></p>
                                    <p class="second_p"><span>{$clt['exp_date']}</span>天内有效</p>
                                    <p class="four_p">{$clt['ctime']} - {$clt['end_time']}</p>
                                </div>
                                <if condition="$clt['is_receive']">
                                    <a href="javascript:" <if condition="$clt['is_receive']">style="padding-top: 45px"</if> >已<br>领<br>取</a>
                                    <else/>
                                    <a href="javascript:" class="btn_use" data-coupon-code="{$clt['coupon_id']}">立<br>即<br>领<br>取</a>
                                </if>
                            </li>
                            <elseif condition="$card_type eq 5"/>
                            <li <if condition="$clt['is_receive']">style="background:url(__APP__/images/bg_none.png) 0 0 no-repeat;background-size:100% 160px;-webkit-background-size:100% 160px;-moz-background-size:100% 160px;-o-background-size:100% 160px;-ms-background-size:100% 160px;"</if>>
                                <div class="left_box">
                                    <p class="first_p"><span class="num"></span><span class="fracture">{$clt['video_title']}</span><span class="coupon">课程券</span></p>
                                    <p class="second_p">仅限指定<span><if condition="$clt.video_type eq 1">课程<elseif condition="$clt.video_type eq 2"/>直播<elseif condition="$clt.video_type eq 3"/>班级</if></span>使用</p>
                                    <p class="four_p">{$clt['ctime']} - {$clt['end_time']}</p>
                                </div>
                                <if condition="$clt['is_receive']">
                                    <a href="javascript:" <if condition="$clt['is_receive']">style="padding-top: 45px"</if> >已<br>领<br>取</a>
                                    <else/>
                                    <a href="javascript:" class="btn_use" data-coupon-code="{$clt['coupon_id']}">立<br>即<br>领<br>取</a>
                                </if>
                            </li>
                        </if>
                    </volist>
                </ul>
                <else/>
                <img style="margin: auto;" src="__APP__/images/course_card_null.png"/>
            </if>
        </div>
        <php>if($card_list['data']){</php>
        <div class="loadding">
            <if condition="$card_list['nowPage'] eq $card_list['totalPages']">
                <div>ᐠ(￣▽￣)ᐟ我可是有底线的</div><else/>正在加载更多。。
            </if></div>
        <a class="backtop"></a>
        <php>}</php>
    </div>
</section>
<!-- content end -->

<script type="text/javascript">
    $(function(){
        var p = 1;
        $(window).scroll(function(){
            var scrollTop = $(this).scrollTop();
            var scrollHeight = $(document).height();
            var windowHeight = $(this).height();
            if(scrollTop + windowHeight == scrollHeight){
                if(!p || p >= "{$card_list['totalPages']}"){
					$('.loadding').html('<div>ᐠ(￣▽￣)ᐟ我可是有底线的</div>');
                    return false;
                }else{
                    p = p+1;
                    ajaxBang();
                }
            }
        });
        //请求事件
        function ajaxBang(){
            $.ajax({
                type: "GET",
                url:"{:U('classroom/CardReceipt/index',['tab'=>$_GET['tab']])}",
                data:"p="+p+"&is_wap=1",
                dataType:"json",
                success:function(data){
                    appendHtml(data);
                }
            });
        }
        //追加html
        function appendHtml(data){
            $("#content_ul_list").append(data.data);
            if(!p || p >= data.totalPages){
                $('.loadding').html('<div>ᐠ(￣▽￣)ᐟ我可是有底线的</div>')
                return false;
            }else{
                p = data.nowPage;//下一页
            }
        }
    });

    $(".btn_use").click(function(){
        if(MID == 0){
            if(confirm("请先登录")){
                var mhm_id='{$this_mhm_id}';
                if(mhm_id){
                    window.location.href  = "{:U('public/Passport/login_g')}"+'?'+'this_mhm_id'+'='+mhm_id;
                }else{
                    window.location.href = "{:U('public/Passport/login_g')}";
                }
            }
            return false;
        }
        var coupon_id = $(this).data('coupon-code');
        $.post(U('classroom/CardReceipt/saveUSerCoupon'),{coupon_id:coupon_id},function(data){
            if(data.status){
                alert(data.info);
                $(this).parent("li").css({"background":"url(__APP__/images/bg_none.png) 0 0 no-repeat","background-size":" 100% 160px","-webkit-background-size":"100% 160px","-moz-background-size":"100% 160px","-o-background-size":"100% 160px","-ms-background-size":"100% 160px"});
                $(this).html("已<br>领<br>取");
                $(this).css({"padding-top":"49px","height":"111px"})

                setTimeout('window.location.reload();', 1500);
            }else{
                alert(data.info);
            }
        },'json');
    })
</script>
<include file="__THEME__/public_footer_w3g" />
