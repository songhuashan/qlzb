<!--header-->
<include file="__THEME__/public_header" />
<!--header end-->

<style media="screen">
	.evaluate_left_box{background: #fff;border-radius: 7px;width: 910px;float: left;min-height: 400px;}
	.evaluate_left_box .head_box{height: 50px;border-bottom: 1px solid #dcdcdc;line-height: 50px;border-radius: 7px 7px 0 0}
	.evaluate_left_box .head_box>a{padding: 0 10px;color: #333;font-size: 14px;}
	.evaluate_left_box .head_box>a:hover{color: #00BED4;}
	.evaluate_left_box .head_box>a.on{color: #00BED4;}
	.evaluate_left_box .nav-content{border-radius: 0 0 7px 7px;}
    .evaluate_right_box{float: right;width: 260px;}
	.evaluate_right_box .overview{overflow:hidden;color:#9D9D9D;font-size:12px;zoom:1;}
	.evaluate_right_box .overview .action{position: relative;padding: 0;margin: 0;background: #00BED4;height: 60px;border-radius: 60px;line-height: 60px;margin-bottom: 30px;}
	.evaluate_right_box .overview .action .btn-primary{margin: 0;padding: 0;width: 100%;height: 100%;line-height: 60px;font-size: 16px;border-radius: 60px;}
	.evaluate_right_box .overview .action .icon-xiedianping{color: #fff;font-size: 16px;position: absolute;left: 62px;top: 0;cursor: pointer;}
	.evaluate_right_boxevaluate_right_box .overview .action a{width:68px;height:30px;text-align:center;line-height:15px;}
	.evaluate_right_box .overview .teacher-score{display:inline-block;padding:20px 40px;height:70px;vertical-align:top;}
	.evaluate_right_box .overview .teacher-score strong{display:block;color:#00BED4;font-weight:700;font-size:36px;font-family:PingHei,'Hiragino Sans GB','Microsoft YaHei',arial,sans-serif;}
	.evaluate_right_box .overview .teacher-score i{margin-top:-3px;width:10px;height:10px;}
	.evaluate_right_box .overview .teacher-score .icon-star{background-position:-160px -222px;}
	.teachevaluate_right_boxer-comment .overview .teacher-score .icon-star_no{background-position:-180px -222px;}
	.evaluate_right_box .overview .detail{position:relative;display:inline-block;margin-top:20px;padding:0 40px;height:90px;color:#9D9D9D;vertical-align:top;font-size:12px;margin-bottom: 20px;}
	.evaluate_right_box .overview .detail .star-comment{position:absolute;top:-20px;left:60px;}
	.evaluate_right_box .overview .detail .text{margin-right:10px;}
	.score_box{background: #fff;}
	.evaluate_right_box .score_head{height: 50px;line-height: 50px;padding-left: 20px;color: #333;font-size: 16px;border-bottom: 1px solid #dcdcdc;}
	.evaluate_left_box .nav-content .item img{border-radius: 50%;}
	.evaluate_right_box .teacher-score .icon-star_no{background-position: -180px -222px;}
	.evaluate_left_box .comment .feedback .icon-dianzan2{font-size: 14px;line-height: 13px;}
	.teacher-content .review_con #review-comments{display: none;margin: auto;margin-bottom: 30px;background: #fff;padding: 10px 30px 0 30px;border-radius: 7px;margin-bottom: 30px;}
	.teacher-content .review_con{width: 100%;}
</style>
<!--top-->
<include file="./top" />
<!--top end-->

<!--content-->
<div class="content adjust">
	<div class="wrap" style="margin-top:0px">
	  <div class="teacher-content">
		<div  class="video-review back review_con">
			<div id="review-comments" class="clearfix">
				<div class="qa-ci-wrap">
					<form id="review_form" onsubmit="return false;">
						<div class="reply-star clearfix">
							<label class="form-label  fl f3" for="score">评分：</label>
							<ul id="star_ul" class="star_ul fl">
								<li class="grade-back-default"></li>
								<li class="grade-back-default"></li>
								<li class="grade-back-default"></li>
								<li class="grade-back-default"></li>
								<li class="grade-back-default"></li>
							</ul>
							<span class="color_hui" id="how-score"></span>
							<p class="fl font12 f9">&nbsp;（请根据课程质量打分）</p>
						</div>

						<label style="margin-right:30px;">授课技巧：
							<select name="skill" id="skill" style="margin-left:10px;">
								<option value="0">请选择</option>
								<option value="1">优</option>
								<option value="2">良</option>
								<option value="3">好</option>
							</select>
						</label>

						<label style="margin-right:30px;">专业知识：
							<select name="Professional" id="Professional" style="margin-left:10px;">
								<option value="0">请选择</option>
								<option value="1">优</option>
								<option value="2">良</option>
								<option value="3">好</option>
							</select>
						</label>
`

						<label style="margin-right:30px;">教学态度：
							<select name="attitude" id="attitude" style="margin-left:10px;">
								<option value="0">请选择</option>
								<option value="1">优</option>
								<option value="2">良</option>
								<option value="3">好</option>
							</select>
						</label>


						<input type="hidden" name="score"  id="course_score"/>
						<textarea id="review_con" class="qa-ci-iarea js-reply-ipt-default" placeholder="点评可以是你对该讲师质量和难度的感受、学习建议，以及可能内容是否符合自己的期望等。..."></textarea>
						<div class="qa-reply-footright fr"> <span class="qa-tips"></span>
							<button type="review" class="btn-mc-light js-ipt-cancel">取消</button>
							<button onclick="doDianpin()" class="btn-mc btn-mini btn-mc-green">确认</button>
						</div>
					</form>
				</div>
			</div>
		</div>
     <div class="evaluate_left_box">
     	<div class="head_box orderBox">
     		<a href="javascript:" class="on" data-order="default">综合排序</a><a href="javascript:" data-order="rentime">最新</a>
     	</div>
		<div class="nav-content">
			<div class="card-main">
				<ul class="classlist clearfix"></ul>
			</div>
			<div class="page">
				<div class="pagebox">
				</div>
			</div>
		</div>
     </div>
 </div>
	 <div class="evaluate_right_box">
		 <div class="overview">
			 <div class="action"><i class="icon icon-xiedianping"></i><a type ="review" href="javascript:;" class="btn btn-primary" id="comment-more">我也评一下</a></div>
             <div class="score_box">
				 <div class="score_head">
				 	综合评价
				 </div>
				 <div class="teacher-score">
					 <strong style="color: #FF9900">{$staro}</strong>
					 <div class="score33">
						 <php>for($i=0;$i<$star;$i++){ </php>
						 <i class="icon-star"></i>
						 <php>}</php>
						 <php>for($i=5;$i>$star;$i--){ </php>
						 <i class="icon-star_no"></i>
						 <php>}</php>
					 </div>
				 </div>
			 <div class="detail single">
				 <div class="star-comment">主动评价星级分布</div>
				 <ul>
					 <li><span class="text">5星</span><div class="progress primary"><div class="meter" style="width: {$fivestar}"></div></div><span style="margin-left: 3px"> {$fivestar} </span></li>
					 <li><span class="text">4星</span><div class="progress primary"><div class="meter" style="width: {$fourstar}"></div></div><span style="margin-left: 3px"> {$fourstar} </span></li>
					 <li><span class="text">3星</span><div class="progress primary"><div class="meter" style="width: {$threestar}"></div></div><span style="margin-left: 3px"> {$threestar} </span></li>
					 <li><span class="text">2星</span><div class="progress primary"><div class="meter" style="width:{$twostar}"></div></div><span style="margin-left: 3px"> {$twostar} </span></li>
					 <li><span class="text">1星</span><div class="progress primary"><div class="meter" style="width:{$onestar}"></div></div><span style="margin-left: 3px"> {$onestar}</span></li>
				 </ul>
			 </div>
		 </div>
		 </div>
	 </div>
    </div>
</div>
<!--content end-->
<!--footer-->
<include file="__THEME__/public_footer" />
<script src="__THEME__/js/jquery.SuperSlide.2.1.1.js"></script>
<script type="text/javascript">
var orderby = "";
var mid = "{$mid}";
var tid = "{$data.id}";
var arr = ['他妈的', '你妈的', '傻×', '衮蛋', '你妹儿'];
$(function() {
    // 加载评论
    $.ajax({
        type: "GET",
        url: "{:U('classroom/Teacher/getreList')}",
        data: "p=1" + "&tid=" + tid + "&type=" + 0,
        dataType: "json",
        success: function(data) {
            appendHtml(data);
        }
    });
    $(document).on('click', '[name="slt-list"] .btn-default', function() {
        $(this).parent().addClass('focus');
        $(this).parent().find('.dropdown-menu').css('display', 'block');
        return false;
    });
    $(document).on('click', '[name="slt-list"] .dropdown-menu li', function() {
        var val = $(this).attr('data-value');
        $(this).addClass('active').siblings().removeClass('active');
        $(this).parent().siblings('.btn-default').find('.txt').text(val);
        $(this).parent().css('display', 'none');
        $(this).parent().parent().removeClass('focus');
        return false;
    });
    $(".orderBox a").click(function() {
        orderby = $(this).data('order');
        $(".classlist").html("");
        tid = tid;
        p = 1;
        ajaxBang();
        $(this).addClass("on").siblings().removeClass("on");
    });
});
/**
 * 赞
 * @param cate
 * @param id
 */
function zanBang(cate, id) {
    if (MID == 0) {
        reg_login();
        return;
    }
    $.ajax({
        type: "POST",
        url: "{:U('classroom/teacher/addZan')}",
        data: "id=" + id,
        dataType: "text",
        success: function(data) {
            if (data == 200) {
                var text = parseInt($(cate).next().text());
                text = (text + 1);
                $(cate).next().text(text);
                $(cate).children("i.qa-icon").removeClass().addClass("qa-iconhover");
            } else {
                return;
            }
        }
    });
}
//追加html
function getNowPage(url, name) {
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
    var r = url.substr(1).match(reg);
    if (r != null) return unescape(r[2]);
    return null;
}
//加载分页
function setPageBoxClick(totalPages) {
    $(".pagebox a").on('click', function(e) {
        p = getNowPage($(this).attr('href'), 'p');
        if (p > totalPages) {
            return false;
        }
        $(".ind-teacher").html("");
        var e = event || window.event
        if (e.stopPropagation) {
            e.stopPropagation()
        } else {
            e.cancelBubble = true;
        };
        if (e && e.preventDefault) {
            e.preventDefault();
        } else {
            e.returnValue = false;
        }
        ajaxBang();
    });
}
//星星评分
score('star_ul');
//追加html
function appendHtml(data) {
    if (data.data != "") {
        $(".classlist").html("");
        $(".classlist").append(data.data);
        $(".pagebox").html(data.html);
        $("#nowPage").html(data.nowPage + '/' + data.totalPages);
        setPageBoxClick(data.totalPages);
    } else {
        $(".classlist").append("<script>对不起,暂无评价<\/script>");
    }
}

function gotoPage() {
    $(".pagediv a").on('click', function(e) {
        p = $("input[name='pageNum']").val();
        var total = parseInt($("#pageTotal").text());
        if (p > total) {
            alert('超过最大页数！');
            return;
        }
        var e = event || window.event
        if (e.stopPropagation) {
            e.stopPropagation()
        } else {
            e.cancelBubble = true;
        };
        if (e && e.preventDefault) {
            e.preventDefault();
        } else {
            e.returnValue = false;
        }
        ajaxBang();
    });
};
//排序请求事件 TODO
function ajaxBang() {
    $.ajax({
        type: "GET",
        url: "{:U('classroom/Teacher/getreList')}",
        data: "p=" + p + "&type=" + type + "&tid=" + tid + "&order=" + orderby,
        dataType: "json",
        success: function(data) {
            appendHtml(data);
        }
    });
}
var id = '{$uid}';
var review_uid = '{$mid}';
var teauid = '{$teauid}';
//显示/隐藏 问题、笔记、点评输入框
$('#comment-more,.js-ipt-cancel').click(function() {
    if (id <= 0) {
        reg_login();
        return false;
    }
    var types = $(this).attr('type');
    $('#' + types + '-comments').toggle();
});
//星星评分
function score(id) {
    var oStarUl = document.getElementById(id);
    var aLi = oStarUl.children;
    for (var i = 0; i < aLi.length; i++) {
        //aLi[i].style.backgroundPosition=i%2?'-12px 0':'0 0';
        aLi[i].index = i;
        //鼠标移入
        aLi[i].onmouseover = function() {
            for (var i = 0; i < aLi.length; i++) {
                aLi[i].className = "grade-back-default";
            }
            for (var i = 0; i < this.index + 1; i++) {
                aLi[i].className = "grade-back-set";
            }
        };
        aLi[i].onclick = function() {
            $("#course_score").val(this.index + 1);
            $('#how-score').text('评分:' + (this.index + 1) + '分');
        };
    }
}
//写点评
function doDianpin() {
    if (review_uid <= 0) {
        reg_login();
        return false;
    }
    if (teauid == review_uid) {
        notes('自己不能评价自己!');
        return;
    }
    var score = $('#course_score').val();
    var content = $('#review_con').val();
    var skill = $("#skill").val();
    var Professional = $("#Professional").val();
    var attitude = $("#attitude").val();
    content = content.replace(/&nbsp;/ig, "");
    content = content.replace(/[ ]/g, ""); //去除空格
    content = content.replace(/<[^>].*?>/g, ""); //去html标签
    if (score == 0) {
        notes('请给讲师打分!', 'failure');
        return false;
    }
    if (skill == 0) {
        notes('请选择授课技巧!', 'failure');
        return false;
    }
    if (Professional == 0) {
        notes('请选择专业知识!', 'failure');
        return false;
    }
    if (attitude == 0) {
        notes('请选择教学态度!', 'failure');
        return false;
    }
    if (content == "") {
        //ui.error('请输入评价内容!');
        notes('请输入评价内容!', 'failure');
        return false;
    }
    for (var i = 0; i < arr.length; i++) {
        if (content.indexOf(arr[i]) > -1) {
            notes('评价内容不得包含敏感词!', 'failure');
            return false;
        }
    }
    ajaxPinjia(score, content, skill, Professional, attitude);
}
//提交点评
function ajaxPinjia(score, content, skill, Professional, attitude) {
    $.ajax({
        type: "POST",
        url: U('classroom/Teacher/add'),
        data: "score=" + score + '&content=' + content + '&Professional=' + Professional + '&attitude=' + attitude + '&skill=' + skill + '&skill=' + skill + '&tid=' + tid + '&review_uid=' + review_uid,
        async: false,
        dataType: "text",
        success: function(data) {
            $('.js-ipt-cancel').click();
            appendHtml(data);
            ajaxReload();
        }
    });
}
/**
 * 处理ajax返回数据之后的刷新操作
 */
function ajaxReload() {
    callback = "location.href = location.href";
    ui.success("点评成功");
    setTimeout(callback, 1000);
};
</script>
